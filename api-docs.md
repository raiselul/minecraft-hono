# Документация по API Inventory & Crafting

Базовый URL: `http://localhost:<порт>`

---

## Предметы (Items)

### 1. Получить все предметы
- **URL**: `/api/items`
- **Метод**: `GET`
- **Описание**: Возвращает список всех существующих типов предметов из базы данных, включая их `id`, `name`, `maxStack`, и `imageUrl`.

**Формат успешного ответа (200 OK)**:
```json
{
  "items": [
    {
      "id": 1,
      "name": "Wood",
      "description": "Basic building material from trees",
      "imageUrl": "wood.png",
      "maxStack": 64
    },
    ...
  ]
}
```

---

## Инвентарь (Inventory)

### 2. Добавить предмет в инвентарь (Тестовый эндпоинт / Выдача)
- **URL**: `/api/inventory/add`
- **Метод**: `POST`
- **Описание**: Добавляет указанное количество предмета в инвентарь игрока. Алгоритм сначала пытается заполнить уже существующие (неполные) стаки этого же предмета, а неизрасходованный остаток помещает в новые пустые ячейки.

**Тело запроса**:
```json
{
  "itemId": 1,      // ID предмета из таблицы items
  "amount": 20      // Количество для добавления (> 0)
}
```

**Формат успешного ответа (200 OK)**:
```json
{
  "success": true,
  "message": "Added successfully"
}
```
* **Ошибки**:
  * `400 Bad Request` — инвентарь полон (свыше 36 слотов) или переданы некорректные параметры.
  * `404 Not Found` — переданный `itemId` не существует.

---

### 3. Переместить предмет (Drag & Drop)
- **URL**: `/api/inventory/move`
- **Метод**: `POST`
- **Описание**: Обрабатывает перемещение предмета из одного слота в другой:
  - Если целевой слот пуст: предмет просто перемещается в новый `slotIndex`.
  - Если в целевом слоте другой предмет: происходит обмен местами (Swap).
  - Если в целевом слоте такой же предмет: стаки объединяются с учетом `maxStack` конкретного предмета (остаток возвращается в исходный слот).

**Тело запроса**:
```json
{
  "fromSlot": 0,    // Индекс слота, ИЗ которого берем предмет
  "toSlot": 5       // Индекс слота, В который кладем предмет
}
```

**Формат успешного ответа (200 OK)**:
```json
{
  "success": true,
  "message": "Moved successfully"
}
```
* **Ошибки**:
  * `400 Bad Request` — переданы одинаковые слоты.
  * `404 Not Found` — предмет в `fromSlot` не найден.

---

### 4. Разделить стак (Split)
- **URL**: `/api/inventory/split`
- **Метод**: `POST`
- **Описание**: Отделяет часть стака из исходного слота в новый слот (или к существующему такому же).

**Тело запроса**:
```json
{
  "fromSlot": 0,    // Слот, от которого отщипываем
  "toSlot": 1,      // Целевой слот для новой стопки
  "amount": 10      // Сколько единиц берем
}
```

**Формат успешного ответа (200 OK)**:
```json
{
  "success": true,
  "message": "Split successfully"
}
```
* **Ошибки**:
  * `400 Bad Request` — недостаточно предметов в исходном слоте, попытка сложить в слот с *другим* предметом или нехватка места (`maxStack`) в целевом слоте.
  * `404 Not Found` — предмет в `fromSlot` не найден.

---

### 5. Выбросить предмет (Drop)
- **URL**: `/api/inventory/drop`
- **Метод**: `DELETE`
- **Описание**: Уменьшает количество предметов в слоте или полностью удаляет стак.

**Тело запроса**:
```json
{
  "slotIndex": 0,   // Слот, из которого удаляем
  "amount": 1       // (Опционально) Количество для удаления. Если не передать — удалится весь стак.
}
```

**Формат успешного ответа (200 OK)**:
```json
{
  "success": true,
  "message": "Dropped successfully"
}
```
* **Ошибки**:
  * `400 Bad Request` — если `amount` передано, но меньше или равно 0.
  * `404 Not Found` — предмет в `slotIndex` не найден.

---

## Крафт (Crafting)

### 6. Создание предмета
- **URL**: `/api/craft`
- **Метод**: `POST`
- **Описание**: Пытается скрафтить предмет по рецепту `recipeId`. Скрипт проверит наличие необходимых ингредиентов, спишет их с инвентаря (в первую очередь сжигая самые маленькие стаки) и добавит скрафченный предмет в инвентарь (с учетом стакания и свободных слотов). Вся операция проходит в Drizzle `transaction` для гарантии целостности.

**Тело запроса**:
```json
{
  "recipeId": 1     // ID рецепта из таблицы recipes
}
```

**Формат успешного ответа (200 OK)**:
```json
{
  "success": true,
  "message": "Crafted successfully"
}
```
* **Ошибки**:
  * `400 Bad Request` — недостаточно ингредиентов для крафта или инвентарь полон.
  * `404 Not Found` — указанный `recipeId` не найден.
